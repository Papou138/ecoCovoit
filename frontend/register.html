<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inscription – ecoCovoit</title>
    <link rel="stylesheet" href="assets/css/_commun.css" />
    <link rel="stylesheet" href="assets/css/_header.css" />
    <link rel="stylesheet" href="assets/css/_footer.css" />
    <link rel="stylesheet" href="assets/css/register.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
  </head>
  <body>
    <header>
      <div class="header-content">
        <div class="logo-container">
          <img
            src="assets/img/logo-ecoRide.png"
            alt="Logo ecoCovoit"
            class="logo"
            width="50"
            height="50"
            loading="lazy"
          />
          <h1 class="app-title">ecoCovoit</h1>
        </div>

        <button
          id="menu-toggle"
          class="menu-toggle"
          aria-label="Ouvrir le menu Principal"
          aria-expanded="false"
          aria-controls="main-nav"
          type="button"
        >
          <span class="hamburger-line" aria-hidden="true"></span>
          <span class="hamburger-line" aria-hidden="true"></span>
          <span class="hamburger-line" aria-hidden="true"></span>
        </button>

        <nav
          id="main-nav"
          class="main-nav"
          role="navigation"
          aria-label="Menu principal de navigation"
        >
          <ul class="nav-list">
            <li>
              <a href="index.html" class="nav-link"><i></i> Accueil</a>
            </li>
            <li>
              <a href="rechercher-covoiturage.html" class="nav-link"
                ><i></i> Rechercher</a
              >
            </li>
            <li>
              <a href="login.html" class="nav-link"><i></i> Connexion</a>
            </li>
            <li>
              <a href="register.html" class="nav-link active"
                ><i></i> Inscription</a
              >
            </li>
            <li>
              <a href="contact.html" class="nav-link"><i></i> Contact</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main>
      <div class="auth-container">
        <div class="auth-card">
          <div class="auth-header">
            <h1>Rejoignez ecoCovoit</h1>
            <p>Créez votre compte pour commencer à partager vos trajets</p>
          </div>

          <form id="register-form" class="auth-form">
            <div class="form-row">
              <div class="form-group">
                <label for="prenom"><i class="fas fa-user"></i> Prénom</label>
                <input
                  type="text"
                  id="prenom"
                  name="prenom"
                  required
                  placeholder="Votre prénom"
                />
              </div>
              <div class="form-group">
                <label for="nom"><i class="fas fa-user"></i> Nom</label>
                <input
                  type="text"
                  id="nom"
                  name="nom"
                  required
                  placeholder="Votre nom"
                />
              </div>
            </div>

            <div class="form-group">
              <label for="pseudo"><i class="fas fa-at"></i> Pseudo</label>
              <input
                type="text"
                id="pseudo"
                name="pseudo"
                required
                placeholder="Choisissez un pseudo unique"
              />
            </div>

            <div class="form-group">
              <label for="email"><i class="fas fa-envelope"></i> Email</label>
              <input
                type="email"
                id="email"
                name="email"
                required
                placeholder="votre.email@exemple.fr"
              />
            </div>

            <div class="form-group">
              <label for="telephone"
                ><i class="fas fa-phone"></i> Téléphone</label
              >
              <input
                type="tel"
                id="telephone"
                name="telephone"
                required
                placeholder="06 12 34 56 78"
              />
            </div>

            <div class="form-group">
              <label for="password"
                ><i class="fas fa-lock"></i> Mot de passe</label
              >
              <input
                type="password"
                id="password"
                name="password"
                required
                placeholder="Minimum 8 caractères"
              />
              <div class="password-strength" id="password-strength"></div>
            </div>

            <div class="form-group">
              <label for="confirm-password"
                ><i class="fas fa-lock"></i> Confirmez le mot de passe</label
              >
              <input
                type="password"
                id="confirm-password"
                name="confirm-password"
                required
                placeholder="Répétez votre mot de passe"
              />
            </div>

            <div class="form-group checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" id="terms" name="terms" required />
                <span class="checkmark"></span>
                J'accepte les
                <a href="mentions.html" target="_blank"
                  >conditions d'utilisation</a
                >
                et la
                <a href="mentions.html#privacy" target="_blank"
                  >politique de confidentialité</a
                >
              </label>
            </div>

            <div class="form-group checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" id="newsletter" name="newsletter" />
                <span class="checkmark"></span>
                Je souhaite recevoir la newsletter ecoCovoit
              </label>
            </div>

            <button type="submit" class="auth-button" id="register-btn">
              <i class="fas fa-user-plus"></i>
              Créer mon compte
            </button>

            <div id="register-message" class="message-box hidden"></div>
          </form>

          <div class="auth-footer">
            <p>Déjà inscrit ? <a href="login.html">Connectez-vous ici</a></p>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <div class="footer-section">
          <h3>Contact</h3>
          <p>Email: contact@ecocovoit.fr</p>
        </div>
        <div class="footer-section">
          <h3>Informations</h3>
          <ul>
            <li><a href="mentions.html">Mentions légales</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 EcoCovoit. Tous droits réservés.</p>
      </div>
    </footer>

    <script src="assets/js/menu.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('register-form');
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput =
          document.getElementById('confirm-password');

        // Validation du mot de passe en temps réel
        passwordInput.addEventListener('input', function () {
          const password = this.value;
          const strength = checkPasswordStrength(password);
          updatePasswordStrength(strength);
        });

        // Validation de la confirmation du mot de passe
        confirmPasswordInput.addEventListener('input', function () {
          const password = passwordInput.value;
          const confirmPassword = this.value;

          if (confirmPassword && password !== confirmPassword) {
            this.setCustomValidity('Les mots de passe ne correspondent pas');
          } else {
            this.setCustomValidity('');
          }
        });

        // Soumission du formulaire
        form.addEventListener('submit', function (e) {
          e.preventDefault();

          if (!validateForm()) return;

          const submitBtn = document.getElementById('register-btn');
          const originalText = submitBtn.innerHTML;

          // Affichage du loading
          submitBtn.innerHTML =
            '<i class="fas fa-spinner fa-spin"></i> Création en cours...';
          submitBtn.disabled = true;

          const formData = new FormData(form);

          fetch('../backend/auth/register.php', {
            method: 'POST',
            body: formData,
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                showMessage(
                  'Compte créé avec succès ! Redirection...',
                  'success'
                );
                setTimeout(() => {
                  window.location.href = 'login.html?registered=1';
                }, 2000);
              } else {
                showMessage(
                  data.message || 'Erreur lors de la création du compte',
                  'error'
                );
              }
            })
            .catch((error) => {
              console.error('Erreur:', error);
              showMessage('Erreur réseau. Veuillez réessayer.', 'error');
            })
            .finally(() => {
              submitBtn.innerHTML = originalText;
              submitBtn.disabled = false;
            });
        });
      });

      function checkPasswordStrength(password) {
        let score = 0;
        let feedback = [];

        if (password.length >= 8) score++;
        else feedback.push('Au moins 8 caractères');

        if (/[a-z]/.test(password)) score++;
        else feedback.push('Une minuscule');

        if (/[A-Z]/.test(password)) score++;
        else feedback.push('Une majuscule');

        if (/\d/.test(password)) score++;
        else feedback.push('Un chiffre');

        if (/[^A-Za-z0-9]/.test(password)) score++;
        else feedback.push('Un caractère spécial');

        return { score, feedback };
      }

      function updatePasswordStrength(strength) {
        const indicator = document.getElementById('password-strength');
        const { score, feedback } = strength;

        let className = '';
        let text = '';

        switch (score) {
          case 0:
          case 1:
            className = 'weak';
            text = 'Très faible - ' + feedback.join(', ');
            break;
          case 2:
            className = 'weak';
            text = 'Faible - ' + feedback.join(', ');
            break;
          case 3:
            className = 'medium';
            text = 'Moyen - ' + feedback.join(', ');
            break;
          case 4:
            className = 'strong';
            text = 'Fort - ' + feedback.join(', ');
            break;
          case 5:
            className = 'very-strong';
            text = 'Très fort';
            break;
        }

        indicator.className = `password-strength ${className}`;
        indicator.textContent = text;
      }

      function validateForm() {
        const password = document.getElementById('password').value;
        const confirmPassword =
          document.getElementById('confirm-password').value;
        const terms = document.getElementById('terms').checked;

        if (password !== confirmPassword) {
          showMessage('Les mots de passe ne correspondent pas', 'error');
          return false;
        }

        if (!terms) {
          showMessage(
            "Vous devez accepter les conditions d'utilisation",
            'error'
          );
          return false;
        }

        if (password.length < 8) {
          showMessage(
            'Le mot de passe doit contenir au moins 8 caractères',
            'error'
          );
          return false;
        }

        return true;
      }

      function showMessage(text, type) {
        const messageBox = document.getElementById('register-message');
        messageBox.textContent = text;
        messageBox.className = `message-box ${type}`;
        messageBox.style.display = 'block';

        // Auto-hide après 5 secondes pour les messages de succès
        if (type === 'success') {
          setTimeout(() => {
            messageBox.style.display = 'none';
          }, 5000);
        }
      }
    </script>
  </body>
</html>
