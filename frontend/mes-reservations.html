<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mes r√©servations ‚Äì ecoCovoit</title>
    <link rel="stylesheet" href="assets/css/_commun.css" />
    <link rel="stylesheet" href="assets/css/_header.css" />
    <link rel="stylesheet" href="assets/css/_footer.css" />
    <link rel="stylesheet" href="assets/css/mes-reservations.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>
  <body>
    <header>
      <div class="header-content">
        <div class="logo-container">
          <img
            src="assets/img/logo-ecoRide.png"
            alt="Logo ecoCovoit"
            class="logo"
            width="50"
            height="50"
            loading="lazy"
          />
          <h1 class="app-title">ecoCovoit</h1>
        </div>
        
        <button
          id="menu-toggle"
          class="menu-toggle"
          aria-label="Ouvrir le menu Principal"
          aria-expanded="false"
          aria-controls="main-nav"
          type="button"
        >
          <span class="hamburger-line" aria-hidden="true"></span>
          <span class="hamburger-line" aria-hidden="true"></span>
          <span class="hamburger-line" aria-hidden="true"></span>
        </button>

        <nav id="main-nav" class="main-nav" role="navigation" aria-label="Menu principal de navigation">
          <ul class="nav-list">
            <li><a href="index.html" class="nav-link">Accueil</a></li>
            <li><a href="rechercher-covoiturage.html" class="nav-link">Rechercher</a></li>
            <li><a href="add-voyage.html" class="nav-link">Proposer</a></li>
            <li><a href="mes-reservations.html" class="nav-link active">Mes r√©servations</a></li>
            <li><a href="historique.html" class="nav-link">Historique</a></li>
            <li><a href="user-profile.html" class="nav-link">Mon profil</a></li>
            <li><a href="#" class="nav-link" id="logout-nav">D√©connexion</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main>
      <h1>üìÖ Mes trajets r√©serv√©s</h1>
      <div id="reservations-container">Chargement...</div>
    </main>

    <script>
      const container = document.getElementById("reservations-container");

      fetch("../backend/reservations/mes_reservations.php")
        .then((res) => res.json())
        .then((data) => {
          container.innerHTML = "";

          if (data.length === 0) {
            container.innerHTML =
              "<p>Vous n‚Äôavez encore r√©serv√© aucun trajet.</p>";
            return;
          }

          data.forEach((trajet) => {
            const div = document.createElement("div");
            div.classList.add("trajet");

            div.innerHTML = `
            <h3>${trajet.ville_depart} ‚Üí ${trajet.ville_arrivee}</h3>
            <p><strong>Date :</strong> ${trajet.date}</p>
            <p><strong>Chauffeur :</strong> ${trajet.pseudo_chauffeur}</p>
            <p><strong>Statut :</strong> ${trajet.statut}</p>
            ${
              trajet.statut !== "termine"
                ? `<button onclick="annuler(${trajet.id})">‚ùå Annuler</button>`
                : ""
            }
          `;

            container.appendChild(div);
          });
        });

      function annuler(trajetId) {
        if (!confirm("Annuler votre r√©servation pour ce trajet ?")) return;

        fetch("../backend/trajets/annuler.php", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: "trajet_id=" + trajetId,
        })
          .then((res) => res.json())
          .then((data) => {
            alert(data.message);
            location.reload();
          });
      }
    </script>

    <footer class="footer">
      <div class="footer-content">
        <div class="footer-section">
          <h3>Contact</h3>
          <p>Email: contact@ecocovoit.fr</p>
        </div>
        <div class="footer-section">
          <h3>Informations</h3>
          <ul>
            <li><a href="mentions.html">Mentions l√©gales</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 EcoCovoit. Tous droits r√©serv√©s.</p>
      </div>
    </footer>

    <script src="assets/js/menu.js"></script>
  </body>
</html>
